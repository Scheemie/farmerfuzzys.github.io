<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Alarm Monitor Erfurt</title>
    <style>
        body { background: #000; color: white; font-family: sans-serif; margin: 0; text-align: center; overflow: hidden; }
        #idle-view { display: flex; flex-direction: column; justify-content: center; height: 100vh; }
        .clock { font-size: 10rem; font-weight: bold; }
        .weather { font-size: 3rem; color: #00f2ff; margin-bottom: 20px; }
        .fz-status-bar { display: flex; justify-content: center; gap: 15px; position: absolute; bottom: 40px; width: 100%; }
        .fz-dot { padding: 10px 20px; background: #111; border-radius: 5px; border-bottom: 5px solid #555; }
        .stat-2 { border-color: #10b981; } /* Frei Funk */
    </style>
</head>
<body>

    <div id="idle-view">
        <div class="weather" id="weather-display">Lade Wetter Erfurt...</div>
        <div class="clock" id="clock-display">00:00:00</div>
        <div class="fz-status-bar" id="fz-bar"></div>
    </div>

    <script type="module">
        // 1. ECHTE UHRZEIT
        function updateClock() {
            const now = new Date();
            document.getElementById('clock-display').innerText = now.toLocaleTimeString('de-DE');
        }
        setInterval(updateClock, 1000);
        updateClock();

        // 2. ECHTES WETTER (Erfurt Koordinaten)
        async function updateWeather() {
            try {
                const response = await fetch("https://api.open-meteo.com/v1/forecast?latitude=50.9787&longitude=11.0328&current_weather=true");
                const data = await response.json();
                const temp = data.current_weather.temperature;
                document.getElementById('weather-display').innerText = `Erfurt: ${temp}°C`;
            } catch (e) {
                document.getElementById('weather-display').innerText = "Wetter aktuell nicht verfügbar";
            }
        }
        setInterval(updateWeather, 600000); // Alle 10 Min neu
        updateWeather();

        // 3. SICHERHEIT & FIREBASE
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { /* DEINE CONFIG WIE OBEN */ };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        onAuthStateChanged(auth, (user) => {
            if (!user) window.location.href = "index.html";
        });

        // Fahrzeug-Status unten anzeigen
        onSnapshot(collection(db, "users"), (snap) => {
            const bar = document.getElementById('fz-bar');
            bar.innerHTML = "";
            snap.forEach(doc => {
                const d = doc.data();
                if(d.role && d.role.includes("Einsatzfahrzeug")) {
                    bar.innerHTML += `<div class="fz-dot stat-${d.status || 1}">${d.username}</div>`;
                }
            });
        });
    </script>
</body>
</html>
