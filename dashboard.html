<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
  <h1>Dashboard</h1>

  <div id="selfPanel"></div>
  <div id="adminPanel"></div>

  <button onclick="logout()">Logout</button>
</div>

<script>
const me = JSON.parse(localStorage.currentUser || "null");
if (!me) location.href = "index.html";

const users = JSON.parse(localStorage.users);

function logout() {
  localStorage.removeItem("currentUser");
  location.href = "index.html";
}

/* ========== EIGENE DATEN ========= */
selfPanel.innerHTML = `
  <h3>Meine Daten</h3>
  <p>Benutzer: <b>${me.user}</b></p>
  <input id="newPass" type="password" placeholder="Neues Passwort">
  <button onclick="changePass()">Passwort ändern</button>
`;

function changePass() {
  const u = users.find(x => x.user === me.user);
  u.pass = newPass.value;
  localStorage.users = JSON.stringify(users);
  alert("Passwort geändert");
}

/* ========== ADMIN PANEL ========= */
if (me.role === "admin") {
  adminPanel.innerHTML = `
    <h3>Admin – Benutzerverwaltung</h3>

    <input id="newUser" placeholder="Benutzername">
    <input id="newUserPass" placeholder="Passwort">
    <button class="admin" onclick="addUser()">Benutzer erstellen</button>

    <div class="list" id="list"></div>
  `;
  render();
}

function render() {
  list.innerHTML = "";
  users.forEach((u, i) => {
    list.innerHTML += `
      <div class="user">
        ${u.user} (${u.role})
        <div>
          <button onclick="toggleAdmin(${i})">Admin</button>
          <button onclick="delUser(${i})">X</button>
        </div>
      </div>
    `;
  });
}

function addUser() {
  users.push({ user: newUser.value, pass: newUserPass.value, role: "user" });
  localStorage.users = JSON.stringify(users);
  render();
}

function delUser(i) {
  if (users[i].user === me.user) return alert("Du kannst dich nicht selbst löschen");
  users.splice(i, 1);
  localStorage.users = JSON.stringify(users);
  render();
}

function toggleAdmin(i) {
  users[i].role = users[i].role === "admin" ? "user" : "admin";
  localStorage.users = JSON.stringify(users);
  render();
}
</script>

</body>
</html>
