<script type="module">
    // ... Firebase Importe (auth, db etc.) ...

    // FUNKTION: Mitglieder laden & Rollen-Leuchten
    async function loadUsers() {
        const list = document.getElementById('user-list');
        const snap = await getDocs(collection(db, "users"));
        list.innerHTML = "";
        
        snap.forEach(d => {
            const u = d.data();
            const roles = u.role || [];
            
            list.innerHTML += `
                <div class="user-row">
                    <span>${u.username}</span>
                    <div class="role-grid">
                        <button onclick="toggleRole('${d.id}', ${JSON.stringify(roles)}, 'Admin')" 
                            class="glow-btn ${roles.includes('Admin') ? 'active-admin' : ''}">Admin</button>
                        
                        <button onclick="toggleRole('${d.id}', ${JSON.stringify(roles)}, 'Alarm Display Admin')" 
                            class="glow-btn ${roles.includes('Alarm Display Admin') ? 'active-alarm-admin' : ''}">Alarm Admin</button>
                        
                        <button onclick="toggleRole('${d.id}', ${JSON.stringify(roles)}, 'AD')" 
                            class="glow-btn ${roles.includes('AD') ? 'active-ad' : ''}">AD</button>
                        
                        <button onclick="toggleRole('${d.id}', ${JSON.stringify(roles)}, 'Gesperrt')" 
                            class="glow-btn ${roles.includes('Gesperrt') ? 'active-blocked' : ''}">Sperren</button>
                    </div>
                </div>`;
        });
    }

    // FUNKTION: Rollen umschalten
    window.toggleRole = async (uid, currentRoles, role) => {
        let newRoles = currentRoles.includes(role) 
            ? currentRoles.filter(r => r !== role) 
            : [...currentRoles, role];
        
        try {
            await updateDoc(doc(db, "users", uid), { role: newRoles });
            loadUsers(); // Liste aktualisieren
        } catch (e) {
            alert("Fehler: Du hast keine Admin-Rechte im System!");
        }
    };

    // ... Restliche Funktionen (registerUser, logout) ...
</script>
